# GraduationDesign
## 总览
本人本科毕业设计为serverless平台的一项优化策略，此项目为论文中使用的模拟器。
其中包含内容主要有：
1. 单invoker的 FaaS 系统模拟器。
2. 论文实验过程中生成的一部分中间数据。
3. 数据处理代码以及绘图代码。

---
## 模拟器使用流程

<br>

### 一. 生成输入数据
#### 1.数据集获取
首先在github上获取Azure提供的公开数据集，本模拟器采用的是Azure 2019年的数据集。[点此](https://github.com/Azure/AzurePublicDataset/blob/master/AzureFunctionsDataset2019.md)下载以及查看相关信息。

Azure完整的提供了12天的数据。本人实验过程中主要使用第一天的数据。模拟器输入数据需要调用`scripts`文件夹下的python脚本进行处理。**在调用脚本前，请手动更改各个脚本中输入数据以及脚本输出数据的路径**。

#### 2.函数采样
首先调用combine脚本，此脚本会将第一天的`mem`、`invocation`和`duration`三个数据表格合并为一个整体的表格。

之后可调用`generate_func`脚本。此脚本会从`combine.csv`文件中采样函数。脚本中提供了三种采样方式，分别是均匀采样、采样低频函数、采样高频函数。这对应论文中使用的三种负载，读者可更改脚本最后一行决定采样方式和采样数量。

`generate_func`脚本中在采样后会默认调用`generate_invoke_df()`，此python函数会使用被采样的函数数据集生成第一天的调用文件。调用文件`invokes.csv`每行即代表一条调用记录，按照调用的毫秒从小到大排序。*请注意，如果采样的函数被调用频次过高，一天内调用次数过多，`invokes.csv`可能有数千万行，导致文件会有数十`G`大*。而且，此过程比较耗时，如果读者只想简单采样函数，请在脚本中注释掉`generate_invoke_df()`的调用。

#### 3.结果
采样后得到的文件`functions.csv`和`invokes.csv`相当于被采样的函数数据库和调用表，模拟器会读取这两项文件进行模拟。

<br>

### 二. 生成时间序列预测结果
论文在采取动态策略（DSMP）时会使用时序预测技术对高频函数进行时序预测。使用`timeSeriesPrediction`文件夹下的脚本可以对函数进行时序预测。如果读者不尝试动态策略，无需进行此步。

时序预测需要用到完整的12天数据，请注意路径的修改和设置。此外，请在脚本开头正确设置要预测函数的哈希名。

预测过程中会生成中间文件，可以不去理会，预测后生成的`predictions.csv`文件被用于模拟器的输入。

<br>

### 三. 使用模拟器
test.java文件包含了模拟器使用的例子。用户需手动设置各项输入输出路径以及模拟的内存大小，模拟策略等，之后再调用几个函数即可。文件中`test`函数展示了如何进行单次模拟，`test2`函数展示了在设置不同策略、内存以及超时时间时如何连续模拟多次。读者可参照源码示例自行尝试。

<br>

### 四. 模拟器输出
模拟器模拟结束后会在控制台打印基本的调用结果统计以及定位到的高频函数。如需获取诸如内存占用、容器占用等数据，需手动添加纪录类并在模拟循环的适当位置进行记录。我们在`Record`包中实现了数个纪录类，用户可参照源码自行添加。

模拟结束后会输出各种对应的结果文件，**请注意输出路径的修改与添加**。

